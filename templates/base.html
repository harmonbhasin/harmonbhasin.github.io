<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{TITLE}}</title>

  <!-- SEO Meta Tags -->
  <meta name="description" content="Harmon Bhasin - Computational Biology and Biosecurity">
  <meta name="robots" content="index, follow">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Highlight.js CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">

  <!-- KaTeX CSS for LaTeX -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/favicon.png">

  <!-- Umami Analytics -->
  <script defer src="https://cloud.umami.is/script.js" data-website-id="27d21137-87c1-42a6-9f44-77815c153950"></script>

  <style>
    /* ========================================
       MAIN BLOG STYLING CONFIGURATION
       ========================================

       This section controls the overall appearance of your blog.

       KEY AREAS TO CUSTOMIZE:

       1. TYPOGRAPHY & COLORS (below)
          - Text color, font sizes, spacing
          - Heading styles
          - Link colors

       2. LAYOUT (body tag at line ~179)
          - Background color: bg-white

       3. NAVIGATION (header at line ~182)
          - Header border, colors, spacing

       4. CONTENT WIDTH (article in build.js:179)
          - Main content container: max-w-3xl

       ======================================== */

    /* Custom prose styles */
    .prose {
      max-width: 100%;
      color: #1F2937;  /* Main text color - change here for different text color */
    }
    /* Heading styles */
    .prose h1 {
      font-size: 2rem;         /* H1 size - change for larger/smaller main headings */
      margin-bottom: 1rem;
      font-weight: bold;
    }
    .prose h2 {
      font-size: 1.5rem;       /* H2 size */
      margin-bottom: 0.5rem;
      font-weight: bold;
    }
    .prose h3 {
      font-size: 1.25rem;      /* H3 size */
      margin-bottom: 0.5rem;
      font-weight: bold;
    }

    /* Link styles */
    .prose a {
      color: #000;             /* Link color - change to customize link appearance */
      text-decoration: underline;
    }
    .prose a:hover {
      color: #2563EB;          /* Link hover color - blue by default */
    }
    .prose ul {
      list-style-type: disc;
      margin-left: 1.5rem;
      margin-bottom: 1rem;
    }
    .prose ol {
      list-style-type: decimal;
      margin-left: 1.5rem;
      margin-bottom: 1rem;
    }
    /* Paragraph and text styles */
    .prose p {
      margin-bottom: 1rem;
      margin-top: 1rem;
      line-height: 1.7;        /* Line height - increase for more spacing between lines */
    }

    /* Blockquote styles */
    .prose blockquote {
      font-style: italic;
      margin: 1.5em 0;
      padding: 0 1em;
      border-left: 4px solid #ccc;  /* Blockquote border color */
      color: #4B5563;                /* Blockquote text color */
    }

    /* Code block styles */
    .prose pre {
      background: #f6f8fa;          /* Code block background - change for dark theme */
      padding: 1rem;
      border-radius: 0.375rem;
      overflow-x: auto;
      margin: 1rem 0;
    }

    /* Inline code styles */
    .prose code {
      background: #f6f8fa;          /* Inline code background */
      padding: 0.2em 0.4em;
      border-radius: 0.25rem;
      font-size: 0.875em;
    }
    .prose pre code {
      background: none;
      padding: 0;
    }

    /* Horizontal rule styles */
    .prose hr {
      border: none;
      border-top: 1px solid #E5E7EB;
      margin: 2rem 0;
    }

    /* Tufte-style sidenotes */
    .sidenote, .marginnote {
      float: right;
      clear: right;
      margin-right: -60%;
      width: 50%;
      margin-top: 0.3rem;
      margin-bottom: 0;
      font-size: 0.9rem;
      line-height: 1.3;
      vertical-align: baseline;
      position: relative;
      color: #4B5563;
    }

    .sidenote-number {
      counter-increment: sidenote-counter;
      text-decoration: none !important;
      cursor: default;
    }

    .sidenote-number:hover {
      color: inherit;
      text-decoration: none !important;
    }

    .sidenote-number:after,
    .sidenote:before {
      position: relative;
      vertical-align: baseline;
    }

    .sidenote-number:after {
      content: counter(sidenote-counter);
      font-size: 0.85rem;
      left: 0.1rem;
    }

    .sidenote:before {
      content: counter(sidenote-counter) " ";
      font-size: 0.7rem;
      top: -0.5rem;
    }

    /* Reset counter for each article */
    article {
      counter-reset: sidenote-counter;
    }

    /* Hide default footnote section */
    .footnotes {
      display: none;
    }

    /* Responsive: stack sidenotes on mobile */
    @media (max-width: 1024px) {
      .sidenote, .marginnote {
        display: none; /* Hidden by default on mobile */
        float: none;
        margin-right: 0;
        width: 100%;
        margin-left: 1.5rem;
        margin-top: 0.5rem;
        margin-bottom: 1rem;
        padding: 1rem;
        background: #f9fafb;
        border-left: 3px solid #3B82F6;
      }

      .sidenote.active {
        display: block; /* Show when clicked */
      }

      .sidenote-number {
        cursor: pointer;
        color: #3B82F6;
      }

      .sidenote-number:hover {
        color: #2563EB;
      }
    }
  </style>
</head>
<body class="bg-white">
  <!-- Header Navigation -->
  <header class="border-b">
    <nav class="max-w-6xl mx-auto px-4 py-4">
      <div class="flex justify-between items-center">
        <a href="/" class="text-xl font-bold">Harmon Bhasin</a>
        <div class="space-x-6">
          <a href="/" class="hover:text-blue-600">Home</a>
          <a href="/about" class="hover:text-blue-600">About</a>
          <a href="/blog" class="hover:text-blue-600">Blog</a>
          <a href="https://x.com/_harm0n" class="hover:text-blue-600">Twitter</a>
        </div>
      </div>
    </nav>
  </header>

  <!-- Main Content -->
  <main>
    {{CONTENT}}
  </main>

  <!-- Search and Filter JavaScript -->
  <script>
    // Convert footnotes to Tufte-style sidenotes
    document.addEventListener('DOMContentLoaded', () => {
      const footnoteRefs = document.querySelectorAll('a[href^="#footnote-"]');

      footnoteRefs.forEach((ref, index) => {
        // Get the footnote ID
        const footnoteId = ref.getAttribute('href').substring(1);
        const footnoteContent = document.getElementById(footnoteId);

        if (footnoteContent) {
          // Get the footnote text (skip the backref link)
          const footnoteText = footnoteContent.querySelector('p');
          if (footnoteText) {
            // Remove the backref link from the footnote text
            const backref = footnoteText.querySelector('a[data-footnote-backref]');
            if (backref) backref.remove();

            // Create sidenote
            const sidenote = document.createElement('span');
            sidenote.className = 'sidenote';
            sidenote.innerHTML = footnoteText.innerHTML;

            // Replace the footnote reference with a sidenote number
            ref.classList.add('sidenote-number');
            ref.removeAttribute('href');
            ref.innerHTML = '';

            // Insert sidenote after the reference
            ref.parentNode.insertBefore(sidenote, ref.nextSibling);

            // Add click handler for mobile
            ref.addEventListener('click', (e) => {
              e.preventDefault();

              // Toggle this sidenote
              sidenote.classList.toggle('active');

              // Close other sidenotes on mobile
              document.querySelectorAll('.sidenote').forEach(otherNote => {
                if (otherNote !== sidenote) {
                  otherNote.classList.remove('active');
                }
              });
            });
          }
        }
      });
    });

    // Search functionality
    const searchInput = document.getElementById('search-input');
    const postsContainer = document.getElementById('posts-container');
    const noResults = document.getElementById('no-results');

    if (searchInput) {
      searchInput.addEventListener('input', (e) => {
        const query = e.target.value.toLowerCase();
        const posts = document.querySelectorAll('.post-item');
        let visibleCount = 0;

        posts.forEach(post => {
          const title = post.querySelector('h2').textContent.toLowerCase();
          const description = post.querySelector('p').textContent.toLowerCase();
          const matches = title.includes(query) || description.includes(query);

          post.style.display = matches ? 'block' : 'none';
          if (matches) visibleCount++;
        });

        noResults.classList.toggle('hidden', visibleCount > 0);
      });
    }

    // Category filtering
    const categoryButtons = document.querySelectorAll('.category-filter');

    categoryButtons.forEach(button => {
      button.addEventListener('click', () => {
        const category = button.dataset.category;
        const posts = document.querySelectorAll('.post-item');

        // Update active button
        categoryButtons.forEach(btn => {
          btn.classList.remove('bg-blue-500', 'text-white');
          btn.classList.add('hover:bg-gray-100');
        });
        button.classList.add('bg-blue-500', 'text-white');
        button.classList.remove('hover:bg-gray-100');

        // Filter posts
        let visibleCount = 0;
        posts.forEach(post => {
          const categories = post.dataset.categories.split(',');
          const matches = category === 'all' || categories.includes(category);

          post.style.display = matches ? 'block' : 'none';
          if (matches) visibleCount++;
        });

        // Clear search when filtering by category
        if (searchInput) searchInput.value = '';
        noResults.classList.toggle('hidden', visibleCount > 0);
      });
    });

    // Support category filtering from URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const categoryParam = urlParams.get('category');
    if (categoryParam) {
      const button = document.querySelector(`[data-category="${categoryParam}"]`);
      if (button) button.click();
    }
  </script>
</body>
</html>
