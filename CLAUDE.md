@docs/LLM.md has the architecture of this.
